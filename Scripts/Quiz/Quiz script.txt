-- Questionário
-- Escrito por Ninguem

nome="Evento Quiz por Wolfy e Soneilon" -- nome para aparecer no topo
questao={
	-- 'p' recebe a pergunta, 'r' recebe um conjunto de respostas a serem consideradas corretas. O script aceita quantas você quiser colocar.
	{p="Qual é o nome da tribo?",r={"Purple Peacocks", "purple peacocks"}},
	{p="Qual o comando que desbloqueia um item de cabeça de bolo? (Coloque o com /)",r={"/atelier801"}},
	{p="Qual título é desbloqueado quando você cria uma conta no Transformice?",r={"ratinho", "Ratinho"}},
	{p="Qual é o nome da sala em que o Shaman deve matar todos os ratos em um limite de tempo?",r={"Survivor", "survivor"}},
	{p="Qual é o modo que não necessita de shaman?",r={"Racing", "racing"}},
	{p="Qual é o piso que faz o seu rato grudar?",r={"Chocolate", "chocolate"}},
	{p="Quantos queijos custa para criar uma tribo? (Somente números)",r={"500"}},
	{p="Qual o prego não pode ser utilizado no modo difícil?",r={"Vermelho", "vermelho"}},
	{p="Quantos morangos você ganha ao completar as missões? (Somente números)",r={"20"}},
	{p="Qual o comando para você parar de receber cochichos? (Coloque o com /)",r={"/silence", "/silence*"}},
	{p="Qual o nome da empresa que é responsável pelo Transformice?",r={"Atelier801", "atelier801", "Atelier 801", "atelier 801"}},
	{p="Quantos saves são necessários para desbloquear o modo difícil? (Somente números)",r={"1000"}},
	{p="Quanto custa o ITEM mais caro que se pode comprar somente com queijos? (Somente números)",r={"4001"}},
	{p="Qual é a tag dos Moderadores? (Seguido da #Número)",r={"#0010"}},
	{p="Há quantas ações de rato no Transformice? (Somente números)",r={"14"}},
	{p="Qual título é desbloqueado quando você consegue 40.000 firsts?",r={"RELÂMPAGO", "relampago", "Relâmpago", "Relampago"}},
	{p="Quantos ratos salvos no modo normal são necessários para desbloquear o modo divino? (Somente números)",r={"5000"}},
	{p="Em que ano o Transformice foi criado? (Somente números)",r={"2010"}},
	{p="Jogadores podem criar contas com #0000 atualmente? (Sim ou Não)",r={"Não", "não", "nao", "Nao"}},
	{p="No ano de 2016 várias contas foram banidas, onde jogadores conseguiam ilegalmente morangos de graça a partir de cartões de créditos falsos, como foi caracterizado esse ocorrido?",r={"Steam fraude", "steam fraude", "Steam Fraude"}},
	{p="Quantos queijos custa a customização de uma roupa no Transformice? (Somente números)",r={"2000"}},
	{p="Quantos queijos custa o pelo mais caro da loja? (Somente números)",r={"10000"}},
	{p="Qual os nicks dos criadores do Transformice? (São dois, e não precisa da tag)",r={"Melibellule e Tigrounette", "Tigrounette e Mellibellule", "tigrounette e mellibellule", "mellibellule e trigounette"}},
	{p="Quantas árvores de habilidades de shaman existem no Transformice? (Somente números)",r={"5"}},
	{p="Qual o comando para reportar algum jogador? (Coloque o com /)",r={"/report"}},
	{p="Com quantas letras é possivel criar uma conta? (Somente números)",r={"3"}},
	{p="Qual é o máximo de caracteres que uma conta pode ter? (Somente números)",r={"12"}},
	{p="Qual o comando para fazer uma ação de bandeira? (Coloque o com /)",r={"/f"}},
	{p="Como é chamado os jogadores que entram como Convidado? (Aqueles que tem o * antes do nick)",r={"Souris", "souris"}},
	{p="Quantos anos o Transformice tem? (Até agora 2023, Somente números)",r={"13"}},
	{p="A habilidade 'Anjo' pode ser obtida completando qual árvore de habilidades?",r={"Mestre do vento", "mestre do vento"}},
	{p="Qual é o máximo de queijos que podem ser guardados no inventário? (Somente números)",r={"1500"}},
	{p="Qual objeto não pode ser utilizado no modo difícil?",r={"SP", "sp", "Spirit", "spirit", "luz", "Luz"}},
	{p="Qual o nome da habilidade que permite direcionar as bolas de canhão para cima?",r={"Cientista louco", "cientista louco"}},
	{p="Quantos ratos podem ser revividos com a habilidade 'Ambulância' no máximo? (Somente Números)",r={"5"}},
	{p="Quantos queijos é necessario para desbloquear o título «É de Mais de 9000» (Somente Números, contem pegadinha!)",r={"9001"}},
	{p="Quantos NPCs existem na sala #village? (Somente Números)",r={"9"}},
	{p="Qual o nome do jogo de Zumbis lançado pela Atelier 801?",r={"Dead Maze"}},
	{p="Em que ano aconteceu o famoso 'Steam Fraude?' (Somente Números)",r={"2016"}},
	{p="Você gostou do Quiz? (Sim ou Sim)",r={"Sim", "sim"}},
	{p="Qual foi o primeiro evento dentro do jogo?",r={"Halloween", "halloween"}},
	{p="Qual comando é utilizado para a inserção de um código especial da Japan Expo? (Coloque o com /)",r={"/code"}},
	{p="Qual é o primeiro nome do Tigrounette?",r={"Jean", "jean"}}
	{p="O jogo Run For Cheese, quando você se cadastra com o seu nick do jogo, você ganha uma medalha, isso ainda é possível? (Sim ou Não)",r={"Não", "não", "nao", "Nao"}},
	{p="Em que ano o Transformice foi para a Steam? (Somente números)",r={"2015"}},
	{p="Qual é o máximo de estrelas nos títulos de bootcamps ou de títulos por itens comprados pode ter? (-> ★, Somente números)",r={"8"}},
	{p="Depois de quanto tempo os ratos afk(parado) desaparecem em salas oficiais? (número + segundos)",r={"30s", "30 segundos", "30 Segundos"}},
	{p="O capacete de 20 queijos é a única roupa que pode ser customizado sem gastar queijos/morangos (Verdadeiro ou Falso)",r={"Verdadeiro", "verdadeiro"}},
	{p="Quantas relíquias são necessárias pra completar o evento de pesca atual? (Somente Números)",r={"60"}},
	{p="É possível usar totem quando shaman, mesmo quando você não está no Modo Difícil? (Verdadeiro ou Falso)",r={"falso", "Falso"}},


	
	
}
mapa=[[<C><P Ca=""/><Z><S><S H="400" P="0,0,0.3,0.2,0,0,0,0" L="800" o="324650" X="400" N="" Y="200" T="12" /></S><D /><O /></Z></C>]]

npag=15
jogador={}

for i, v in pairs(tfm.get.room.playerList) do
	jogador[i] = {p={}, pag=1}
	for j, v in pairs(questao) do
		jogador[i].p[j] = "Responder"
	end
end

function eventNewPlayer(p)
	if jogador[p] == nil then
		jogador[p] = {p={}, pag=1}
		for j, v in pairs(questao) do
			jogador[p].p[j] = "Responder"
		end
	end
	escreve(p)
	verifica(p, false)
end

function correto(r, n)
	for i, v in pairs(questao[n].r) do
		if string.upper(r) == string.upper(v) then
			return true
		end
	end
	return false
end

function win(p, ganha)
	ui.addTextArea(2, "", p, 5, 25, 790, 375, 0x324650, 0x324650, 0.8, true)
	ui.addTextArea(3, "<p align='center'><font size='30pt'>Você terminou!", p, 0, 180, 800, 375, 0, 0, 0, true)
	if ganha then
		print("<j>" .. p .. " terminou.")
		tfm.exec.respawnPlayer(p)
		tfm.exec.giveCheese(p)
		tfm.exec.playerVictory(p)
	end
end

function escreve(p)
	local txt = "<font size='18px'>"
	for i=1+(jogador[p].pag-1)*npag, #questao do
		if i > jogador[p].pag*npag then
			break
		end
		txt = txt .. "<a href='event:" .. i .. "'><j>" .. i .. ") <n>"
		if questao[i].p:len() > 50 then
			txt = txt .. questao[i].p:sub(1,47) .. "..."
		else
			txt = txt .. questao[i].p
		end
		if correto(jogador[p].p[i], i) then
			txt = txt .. " <g>| <vp>"
		else
			txt = txt .. " <g>| <r>"
		end
		if jogador[p].p[i]:len() > 30 then
			txt = txt .. jogador[p].p[i]:sub(1,27) .. "..."
		else
			txt = txt .. jogador[p].p[i]
		end
		txt = txt .. "</a>\n"
	end
	ui.addTextArea(0, txt, p, 10, 30, 780, 330, 0x364852, 0x465862, 1, true)
	ui.addTextArea(10,"<p align='center'><font size='20px'><a href='event:ant'>««</a> " .. jogador[p].pag .. " de " .. math.floor(#questao/npag)+1 .. " <a href='event:prox'>»»\n</a>", p, 5, 365, 790, 100, 0, 0, 0, true)
end

function verifica(p, ganha)
	local pts = 0
	for i=1, #questao do
		if correto(jogador[p].p[i], i) then
			pts = pts + 1
		end
	end
	tfm.exec.setPlayerScore(p, pts, false)
	if pts >= #questao then
		win(p, ganha)
	end
end

function eventPopupAnswer(id, p, r)
	ui.removeTextArea(1, p)
	if r ~= "" then
		jogador[p].p[id] = r
	end
	escreve(p)
	verifica(p, true)
end

function mudaPag(p, n)
	if (jogador[p].pag == 1 and n == "ant") or (jogador[p].pag == math.floor(#questao/npag)+1 and n == "prox") then
		return false
	end
	if n == "ant" then
		jogador[p].pag = jogador[p].pag - 1
	else
		jogador[p].pag = jogador[p].pag + 1
	end
	escreve(p)
end

function eventNewGame()
	tfm.exec.setUIMapName("<p align='center'>" .. nome .. "</p>\n")
end

function eventTextAreaCallback(id, p, n)
	if n == "ant" or n == "prox" then
		mudaPag(p, n)
	else
		ui.addTextArea(1, "", p, 5, 25, 790, 375, 0x324650, 0x324650, 0.8, true)
		ui.addPopup(tonumber(n,10), 2, "<font size='18px'>" .. questao[tonumber(n,10)].p, p, 250, 180, 300, true)
	end
end

fim = false
tfm.exec.disableAutoTimeLeft(true)
tfm.exec.disableAutoShaman(true)
tfm.exec.disableAutoScore(true)

tfm.exec.disableAutoNewGame(true)
tfm.exec.newGame(mapa)
for i, v in pairs(tfm.get.room.playerList) do
tfm.exec.setPlayerScore(i, 0, false)
	escreve(i)
end